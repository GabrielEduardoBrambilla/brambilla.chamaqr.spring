# ═════════════════════════════════════════════════════════════
# Application Configuration - ChamadaQR Backend (Docker)
# ═════════════════════════════════════════════════════════════
#
# Configuração otimizada para execução em container Docker
# Usa variáveis de ambiente para valores dinâmicos
#
# ═════════════════════════════════════════════════════════════

spring.application.name=chamadaqr

# ═════════════════════════════════════════════════════════════
# DATABASE CONFIGURATION (MySQL com SSL obrigatório)
# ═════════════════════════════════════════════════════════════

# Connection URL (via variável de ambiente)
# Formato: jdbc:mysql://HOST:PORT/DATABASE?useSSL=true&requireSSL=true&verifyServerCertificate=true
spring.datasource.url=jdbc:mysql://${MYSQL_HOST:192.168.56.101}:${MYSQL_PORT:3306}/${MYSQL_DATABASE:chamadaqr}?createDatabaseIfNotExist=true&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC

# Credentials (via variáveis de ambiente)
spring.datasource.username=${MYSQL_USER:chamadaqr_ssl}
spring.datasource.password=${MYSQL_PASSWORD:root}

# Driver
spring.jpa.show-sql=true
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.format_sql=true

# ═════════════════════════════════════════════════════════════
# PROFILE CONFIGURATION
# ═════════════════════════════════════════════════════════════

spring.profiles.active=${SPRING_PROFILE:prod}

# ═════════════════════════════════════════════════════════════
# KEYCLOAK CONFIGURATION (via HAProxy)
# ═════════════════════════════════════════════════════════════

# ⚠️ IMPORTANTE: Keycloak via HAProxy para consistência
# URL do HAProxy (não do Keycloak direto!)
keycloak.auth-server-url=${KEYCLOAK_URL:https://192.168.56.104}

# Realm e Client
keycloak.realm=${KEYCLOAK_REALM:chamadaqr}
keycloak.client-id=${KEYCLOAK_CLIENT_ID:chamadaqr-backend}
keycloak.client-secret=${KEYCLOAK_CLIENT_SECRET:LL5uabWie89PrpToq4SqYZZEAW2jpMNo}

# Token URI (construído via HAProxy)
keycloak.token-uri=${KEYCLOAK_URL:https://192.168.56.104}/realms/${KEYCLOAK_REALM:chamadaqr}/protocol/openid-connect/token

# ═════════════════════════════════════════════════════════════
# OAUTH2 RESOURCE SERVER CONFIGURATION
# ═════════════════════════════════════════════════════════════

# JWT Issuer (via HAProxy)
spring.security.oauth2.resourceserver.jwt.issuer-uri=${KEYCLOAK_URL:https://192.168.56.104}/realms/${KEYCLOAK_REALM:chamadaqr}

# JWK Set URI (chaves públicas via HAProxy)
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${KEYCLOAK_URL:https://192.168.56.104}/realms/${KEYCLOAK_REALM:chamadaqr}/protocol/openid-connect/certs

# ═════════════════════════════════════════════════════════════
# SERVER CONFIGURATION (Tomcat SSL)
# ═════════════════════════════════════════════════════════════

# Porta HTTPS
server.port=${SERVER_PORT:8443}

# SSL Habilitado
server.ssl.enabled=true

# Keystore (certificado Tomcat)
server.ssl.key-store=${SSL_KEYSTORE_PATH:/opt/tomcat/conf/ssl/backend.p12}
server.ssl.key-store-password=${SSL_KEYSTORE_PASSWORD:tomcat123}
server.ssl.key-store-type=PKCS12
server.ssl.key-alias=tomcat

# ═════════════════════════════════════════════════════════════
# LOGGING CONFIGURATION
# ═════════════════════════════════════════════════════════════

# Níveis de log
logging.level.root=INFO
logging.level.com.brambilla.chamadaqr=DEBUG
logging.level.com.zaxxer.hikari=DEBUG
logging.level.org.springframework.security=DEBUG

# Formato de log
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# ═════════════════════════════════════════════════════════════
# CORS CONFIGURATION (via CorsConfig.java)
# ═════════════════════════════════════════════════════════════

# CORS configurado programaticamente em CorsConfig.java
# Permite origens do HAProxy e frontends

# ═════════════════════════════════════════════════════════════
# ACTUATOR ENDPOINTS (opcional para health checks)
# ═════════════════════════════════════════════════════════════

# Descomente se quiser usar Spring Boot Actuator
# management.endpoints.web.exposure.include=health,info
# management.endpoint.health.show-details=always

# ═════════════════════════════════════════════════════════════
# NOTAS IMPORTANTES
# ═════════════════════════════════════════════════════════════
#
# 1. VARIÁVEIS DE AMBIENTE:
#    Todas as propriedades dinâmicas usam ${VAR:default}
#    Podem ser sobrescritas em docker run -e VAR=value
#
# 2. KEYCLOAK VIA HAPROXY:
#    keycloak.auth-server-url=https://192.168.56.104
#    NÃO usar URL direta do Keycloak (192.168.56.103:5001)
#
# 3. MYSQL SSL:
#    Certificados em /opt/tomcat/conf/ssl/
#    - mysql-truststore.jks (CA do MySQL)
#    - client-keystore.p12 (certificado cliente)
#
# 4. TOMCAT SSL:
#    Configurado em server.xml
#    Certificado: backend.p12
#
# 5. HEALTH CHECK ENDPOINT:
#    GET /chamadaqr/api/message
#    Retorna: 200 OK com mensagem
#
# 6. CONTEXTO DA APLICAÇÃO:
#    WAR deployado como ROOT.war
#    Base URL: /chamadaqr
#    Exemplo: https://192.168.56.103:8443/chamadaqr/auth/login
#
# ═════════════════════════════════════════════════════════════